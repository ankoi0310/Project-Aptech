@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using NGO.Models.MappingClass
@{
    Layout = "_MainLayoutAll";

    NGO.Models.MappingClass.Program Pro = new NGO.Models.MappingClass.Program();

    if (ViewBag.Program != null)
    {
        Pro = ViewBag.Program;
    }
    List<DonationRecord> listDonationRecord = new List<DonationRecord>();

    if (ViewBag.ListDonationRecord != null)
    {
        listDonationRecord = ViewBag.ListDonationRecord;
    }
    List<ProgramImage> listImage = new List<ProgramImage>();

    if (ViewBag.listImage != null)
    {
        listImage = ViewBag.listImage;
    }
    List<PaymentType> listPayment = new List<PaymentType>();

    if (ViewBag.listPayment != null)
    {
        listPayment = ViewBag.listPayment;
    }
    Member member = new Member();
    member = ViewBag.Member;
    var raised = listDonationRecord.Sum(x => x.Amount);
    var progressRate = (raised / Pro.NeedAmount).ToString("0%"); ;
}

<div class="page-title-area item-bg-5">
    <div class="container">
        <div class="page-title-content">
            <h2>Program Details</h2>
            <ul>
                <li>
                    <a href="index.html">
                        Home
                        <i class="fa fa-chevron-right"></i>
                    </a>
                </li>
                <li>Program Details</li>
            </ul>
        </div>
    </div>
</div>


<section class="blog-details-area ptb-100">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-12">
                <div class="blog-details-desc">
                    <div class="article-image">
                        <div class="single-campaing two">
                            <div class="campaing-img">
                                <img src="/assetsAdmin/images/programs/@listImage.Where(x => x.ProgramId == Pro.Id).FirstOrDefault().Name" alt="">
                            </div>
                            <div class="campaing-text">
                                <h2>@Pro.Name</h2>
                                <div class="progress pink">
                                    <div class="progress-bar">
                                        <div class="progress-value" style="width:@progressRate;">@progressRate</div>
                                    </div>
                                </div>
                                <ul>
                                    <li><span>Raised:</span> @raised.ToString("#,##0")</li>
                                    <li class="left-site"><span>Goal:</span> @Pro.NeedAmount.ToString("#,##0")</li>
                                </ul>
                                <h3>Donation for @Pro.DonationCategory.Name</h3>
                            </div>
                        </div>
                    </div>
                    <div class="article-content causes-details-two">
                        <div class="entry-meta">
                            <ul>
                                <li><span>Begin Date:</span>@Pro.BeginDate.ToShortDateString()</li>
                                <li><span>End Date:</span> @Pro.EndDate.ToShortDateString()</li>
                            </ul>
                        </div>
                        <br />
                        <h6>Donated Amount: @raised.ToString("#,##0")</h6>
                        <h6>Number of Members donate: @listDonationRecord.Sum(x => x.MemberId).ToString("#,##0")</h6>
                        <h3>Informations</h3>
                        <p>@Pro.Information</p>
                    </div>

                    @if (member != null)
                    {
                        <div class="donates-wraps">
                            <div id="smart-button-container">
                                <div style="text-align: center"><label for="description">Nội dung: </label><input type="text" name="descriptionInput" id="description" maxlength="127" value=""></div>
                                <p id="descriptionError" style="visibility: hidden; color:red; text-align: center;">Please enter a description</p>
                                <div style="text-align: center"><label for="amount">Số tiền quyên góp: </label><input name="amountInput" type="number" id="amount" value=""><span> USD</span></div>
                                <p id="priceLabelError" style="visibility: hidden; color:red; text-align: center;">Please enter a price</p>
                                <div id="invoiceidDiv" style="text-align: center; display: none;"><label for="invoiceid"> </label><input name="invoiceid" maxlength="127" type="text" id="invoiceid" value=""></div>
                                <p id="invoiceidError" style="visibility: hidden; color:red; text-align: center;">Please enter an Invoice ID</p>
                                <div style="text-align: center; margin-top: 0.625rem;" id="paypal-button-container"></div>
                            </div>
                            <script src="https://www.paypal.com/sdk/js?client-id=AQVkbrvV36q8ISQ2RteBsEzwY3w-xtomu60brAZ8uVqSS6IUouNVHqLUigCYksdKjEiMYtnLte74i0F0&currency=USD" data-sdk-integration-source="button-factory"></script>
                            <script>
                                function initPayPalButton() {
                                    var description = document.querySelector('#smart-button-container #description');
                                    var amount = document.querySelector('#smart-button-container #amount');
                                    var descriptionError = document.querySelector('#smart-button-container #descriptionError');
                                    var priceError = document.querySelector('#smart-button-container #priceLabelError');
                                    var invoiceid = document.querySelector('#smart-button-container #invoiceid');
                                    var invoiceidError = document.querySelector('#smart-button-container #invoiceidError');
                                    var invoiceidDiv = document.querySelector('#smart-button-container #invoiceidDiv');

                                    var elArr = [description, amount];

                                    if (invoiceidDiv.firstChild.innerHTML.length > 1) {
                                        invoiceidDiv.style.display = "block";
                                    }

                                    var purchase_units = [];
                                    purchase_units[0] = {};
                                    purchase_units[0].amount = {};

                                    function validate(event) {
                                        return event.value.length > 0;
                                    }

                                    paypal.Buttons({
                                        style: {
                                            color: 'blue',
                                            shape: 'pill',
                                            label: 'paypal',
                                            layout: 'horizontal',

                                        },

                                        onInit: function (data, actions) {
                                            actions.disable();

                                            if (invoiceidDiv.style.display === "block") {
                                                elArr.push(invoiceid);
                                            }

                                            elArr.forEach(function (item) {
                                                item.addEventListener('keyup', function (event) {
                                                    var result = elArr.every(validate);
                                                    if (result) {
                                                        actions.enable();
                                                    } else {
                                                        actions.disable();
                                                    }
                                                });
                                            });
                                        },

                                        onClick: function () {
                                            if (description.value.length < 1) {
                                                descriptionError.style.visibility = "visible";
                                            } else {
                                                descriptionError.style.visibility = "hidden";
                                            }

                                            if (amount.value.length < 1) {
                                                priceError.style.visibility = "visible";
                                            } else {
                                                priceError.style.visibility = "hidden";
                                            }

                                            if (invoiceid.value.length < 1 && invoiceidDiv.style.display === "block") {
                                                invoiceidError.style.visibility = "visible";
                                            } else {
                                                invoiceidError.style.visibility = "hidden";
                                            }

                                            purchase_units[0].description = description.value;
                                            purchase_units[0].amount.value = amount.value;

                                            if (invoiceid.value !== '') {
                                                purchase_units[0].invoice_id = invoiceid.value;
                                            }
                                        },

                                        createOrder: function (data, actions) {
                                            return actions.order.create({
                                                purchase_units: purchase_units,
                                            });
                                        },

                                        onApprove: function (data, actions) {
                                            return actions.order.capture().then(function (details) {
                                                alert('Transaction completed by ' + details.payer.name.given_name + '!');
                                            });
                                        },

                                        onError: function (err) {
                                            console.log(err);
                                        }
                                    }).render('#paypal-button-container');
                                }
                                initPayPalButton();
                            </script>
                        </div>
                    }
                    else
                    {
                        <a href="~/login" class="alert alert-info">You need to login/register to donate</a>
                    }


                    <div class="article-footer causes-icon">
                        <div class="article-tags">
                            <span><i class="fa fa-share"></i></span>
                            <a href="#">Share</a>
                        </div>
                        <div class="article-share">
                            <ul class="social">
                                <li><a href="#" target="_blank"><i class="fa fa-facebook-f"></i></a></li>
                                <li><a href="#" target="_blank"><i class="fa fa-twitter"></i></a></li>
                                <li><a href="#" target="_blank"><i class="fa fa-linkedin"></i></a></li>
                                <li><a href="#" target="_blank"><i class="fa fa-instagram"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-12">
                <aside class="widget-area" id="secondary">
                    <div class="widget widget_search">
                        <form class="search-form">
                            <label>
                                <span class="screen-reader-text">Search for:</span>
                                <input type="search" class="search-field" placeholder="Search...">
                            </label>
                            <button type="submit"><i class="fa fa-search"></i></button>
                        </form>
                    </div>
                    <section class="widget widget_zovio_posts_thumb">
                        <h3 class="widget-title">Popular Posts</h3>
                        <article class="item">
                            <a href="#" class="thumb">
                                <span class="fullimage cover bg1" role="img"></span>
                            </a>
                            <div class="info">
                                <time datetime="2019-06-30">June 30, 2019</time>
                                <h4 class="title usmall">
                                    <a href="#">Delicate contempt received two yet advanced</a>
                                </h4>
                            </div>
                            <div class="clear"></div>
                        </article>
                        <article class="item">
                            <a href="#" class="thumb">
                                <span class="fullimage cover bg2" role="img"></span>
                            </a>
                            <div class="info">
                                <time datetime="2019-06-30">June 30, 2019</time>
                                <h4 class="title usmall">
                                    <a href="#">Future Plan & Strategy for Consutruction</a>
                                </h4>
                            </div>
                            <div class="clear"></div>
                        </article>
                        <article class="item">
                            <a href="#" class="thumb">
                                <span class="fullimage cover bg3" role="img"></span>
                            </a>
                            <div class="info">
                                <time datetime="2019-06-30">June 30, 2019</time>
                                <h4 class="title usmall">
                                    <a href="#">Melancholy devonshire alteration</a>
                                </h4>
                            </div>
                            <div class="clear"></div>
                        </article>
                        <article class="item">
                            <a href="#" class="thumb">
                                <span class="fullimage cover bg4" role="img"></span>
                            </a>
                            <div class="info">
                                <time datetime="2019-06-30">June 30, 2019</time>
                                <h4 class="title usmall">
                                    <a href="#">Delicate contempt received two yet advanced</a>
                                </h4>
                            </div>
                            <div class="clear"></div>
                        </article>
                    </section>
                    <section class="widget widget_categories">
                        <h3 class="widget-title">Archives</h3>
                        <ul>
                            <li><a href="#">May 2019</a></li>
                            <li><a href="#">April 2019</a></li>
                            <li><a href="#">June 2019</a></li>
                            <li><a href="#">julay 2019</a></li>
                        </ul>
                    </section>
                    <section class="widget widget_categories">
                        <h3 class="widget-title">Categories</h3>
                        <ul>
                            <li><a href="#">Educataon (10)</a></li>
                            <li><a href="#">National (20)</a></li>
                            <li><a href="#">Sports (10)</a></li>
                            <li><a href="#">Megazine (12)</a></li>
                            <li><a href="#">Health (16)</a></li>
                        </ul>
                    </section>
                    <section class="widget widget_tag_cloud">
                        <h3 class="widget-title">Tags</h3>
                        <div class="tagcloud">
                            <a href="#">Fashion</a>
                            <a href="#">Education</a>
                            <a href="#">Nation</a>
                            <a href="#">Study</a>
                            <a href="#">Health</a>
                            <a href="#">Food</a>
                            <a href="#">Travel</a>
                            <a href="#">Science</a>
                        </div>
                    </section>
                </aside>
            </div>
        </div>
    </div>
</section>